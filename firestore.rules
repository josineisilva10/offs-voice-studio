/**
 * @fileoverview Firestore Security Rules for Voice Actor Demos application.
 *
 * Core Philosophy:
 * This ruleset enforces a role-based access control model where "admins" have full
 * CRUD access to voice actors, demo types, and voice actor demos, while all users
 * can read this information.
 *
 * Data Structure:
 * The database consists of three main collections:
 * - /voice_actors/{voiceActorId}: Stores voice actor profiles.
 * - /demo_types/{demoTypeId}: Stores demo types.
 * - /voice_actors/{voiceActorId}/demos/{demoId}: Stores voice actor demos, nested under
 *   the corresponding voice actor document.
 *
 * Key Security Decisions:
 * - All read operations are publicly accessible to all users, including unauthenticated users.
 * - All write operations (create, update, delete) are restricted to admins only.
 * - The rules explicitly deny any write operations for non-admins, ensuring that only
 *   authorized personnel can modify the data.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows admins to manage voice actor profiles and users to read them.
     * @path /voice_actors/{voiceActorId}
     * @allow (get, list): Any user can read voice actor profiles.
     * @allow (create, update, delete): Only admins can create, update, or delete voice actor profiles.
     * @deny (create, update, delete): Non-admins cannot create, update, or delete voice actor profiles.
     * @principle Enforces role-based access control, allowing read access for all and write access for admins only.
     */
    match /voice_actors/{voiceActorId} {
      allow get, list: if true;
      allow create, update, delete: if isAdmin();
    }

    /**
     * @description Allows admins to manage demo types and users to read them.
     * @path /demo_types/{demoTypeId}
     * @allow (get, list): Any user can read demo types.
     * @allow (create, update, delete): Only admins can create, update, or delete demo types.
     * @deny (create, update, delete): Non-admins cannot create, update, or delete demo types.
     * @principle Enforces role-based access control, allowing read access for all and write access for admins only.
     */
    match /demo_types/{demoTypeId} {
      allow get, list: if true;
      allow create, update, delete: if isAdmin();
    }

    /**
     * @description Allows admins to manage voice actor demos and users to read them.
     * @path /voice_actors/{voiceActorId}/demos/{demoId}
     * @allow (get, list): Any user can read voice actor demos.
     * @allow (create, update, delete): Only admins can create, update, or delete voice actor demos.
     * @deny (create, update, delete): Non-admins cannot create, update, or delete voice actor demos.
     * @principle Enforces role-based access control, allowing read access for all and write access for admins only.
     */
    match /voice_actors/{voiceActorId}/demos/{demoId} {
      allow get, list: if true;
      allow create, update, delete: if isAdmin();
    }

    /**
     * @description Checks if the user is signed in.
     * @return {bool} True if the user is signed in, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Checks if the user is an admin.  This is a placeholder and should be
     *              replaced with your actual admin check (e.g., a custom claim).
     * @return {bool} True if the user is an admin, false otherwise.
     */
    function isAdmin() {
      // TODO: Replace with your actual admin check (e.g., a custom claim).
      return false;
    }
  }
}
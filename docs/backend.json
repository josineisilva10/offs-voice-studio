{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the VozGenius application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "credits": {
          "type": "number",
          "description": "The number of credits the user has available."
        }
      },
      "required": [
        "id",
        "email",
        "name",
        "credits"
      ]
    },
    "Voice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Voice",
      "type": "object",
      "description": "Represents a voice available for text-to-speech generation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the voice."
        },
        "name": {
          "type": "string",
          "description": "Name of the voice."
        },
        "description": {
          "type": "string",
          "description": "Description of the voice characteristics."
        },
        "language": {
          "type": "string",
          "description": "Language of the voice."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "language"
      ]
    },
    "Recording": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recording",
      "type": "object",
      "description": "Represents a voice recording created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recording."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Recording)"
        },
        "voiceId": {
          "type": "string",
          "description": "Reference to Voice. (Relationship: Voice 1:N Recording)"
        },
        "text": {
          "type": "string",
          "description": "The generated text for the recording."
        },
        "audioUrl": {
          "type": "string",
          "description": "URL of the audio file for the recording.",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the recording was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "voiceId",
        "text",
        "audioUrl",
        "createdAt"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date when the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "paymentMethod": {
          "type": "string",
          "description": "The payment method used for the order (e.g., credit card, PayPal)."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., pending, processing, completed, cancelled)."
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount",
        "paymentMethod",
        "status"
      ]
    },
    "Package": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Package",
      "type": "object",
      "description": "Represents a package of credits available for purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the package."
        },
        "name": {
          "type": "string",
          "description": "Name of the credit package."
        },
        "description": {
          "type": "string",
          "description": "Description of the package contents."
        },
        "creditAmount": {
          "type": "number",
          "description": "Number of credits included in the package."
        },
        "price": {
          "type": "number",
          "description": "Price of the package."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "creditAmount",
        "price"
      ]
    },
    "PaymentTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PaymentTransaction",
      "type": "object",
      "description": "Represents a payment transaction for an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment transaction."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N PaymentTransaction)"
        },
        "transactionDate": {
          "type": "string",
          "description": "Date of the payment transaction.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the payment transaction."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the transaction."
        },
        "transactionId": {
          "type": "string",
          "description": "Transaction identifier from the payment gateway."
        },
        "status": {
          "type": "string",
          "description": "Status of the payment transaction (e.g., pending, completed, failed)."
        }
      },
      "required": [
        "id",
        "orderId",
        "transactionDate",
        "amount",
        "paymentMethod",
        "transactionId",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data. Path-based ownership ensures only the user can access their document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recordings/{recordingId}",
        "definition": {
          "entityName": "Recording",
          "schema": {
            "$ref": "#/backend/entities/Recording"
          },
          "description": "Stores user recordings. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "recordingId",
              "description": "The unique identifier for the recording."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores orders placed by users. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/paymentTransactions/{paymentTransactionId}",
        "definition": {
          "entityName": "PaymentTransaction",
          "schema": {
            "$ref": "#/backend/entities/PaymentTransaction"
          },
          "description": "Stores payment transactions for a user's order.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            },
            {
              "name": "paymentTransactionId",
              "description": "The unique identifier for the payment transaction."
            }
          ]
        }
      },
      {
        "path": "/packages/{packageId}",
        "definition": {
          "entityName": "Package",
          "schema": {
            "$ref": "#/backend/entities/Package"
          },
          "description": "Stores credit packages available for purchase.",
          "params": [
            {
              "name": "packageId",
              "description": "The unique identifier for the package."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the VozGenius application, focusing on user-generated recordings, AI voice generation, order management, and credit packages. The primary goal is to ensure secure access and data integrity while adhering to the principles of Authorization Independence and Structural Segregation. Path-based ownership and explicit data modeling are used to enhance security and clarity.\n\n*   **Users:** User data is stored under `/users/{userId}` to ensure path-based ownership for private user data.\n*   **Recordings:** Each user's recordings are stored under `/users/{userId}/recordings/{recordingId}`. This structure provides clear ownership and simplifies security rules. The `userId` field within each recording document is redundant but crucial for Authorization Independence, as it avoids the need for `get()` calls to the parent user document to determine ownership.\n*   **Orders and Payment Transactions:** Orders are stored under `/users/{userId}/orders/{orderId}` and payment transactions are nested under orders at `/users/{userId}/orders/{orderId}/paymentTransactions/{paymentTransactionId}`. This maintains data locality and clear ownership. The `userId` field is duplicated in the order documents (denormalized) for Authorization Independence.\n*   **Packages:** Credit packages are stored in a global `/packages/{packageId}` collection. These packages are globally accessible and their data isn't user-specific, so a single collection is appropriate.\n\nThis structure supports required QAPs by:\n\n*   **Secure List Operations:** Path-based ownership enables secure `list` operations for recordings and orders. Security rules can easily filter based on `request.auth.uid` matching the `userId`.\n*   **Authorization Independence:** Denormalizing the `userId` into `recordings` and `orders` ensures that security rules can validate access without needing to fetch parent documents.\n*   **Explicit State Modeling:** The `Order` entity includes a `status` field to explicitly model the order's state, facilitating predictable query and rule logic."
  }
}